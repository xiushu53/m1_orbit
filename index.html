<!DOCTYPE html>
<html lang="ja">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>M1各大会の平均点と接戦度合の軌跡</title>

    <style type="text/css">
        body {
            font: 12px times;
        }
        
        path {
            stroke: steelblue;
            stroke-width: 2;
            fill: none;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: grey;
            stroke-width: 1;
            shape-rendering: crisEdges;
        }
        
        .grid .tick {
            stroke: lightgrey;
            opacity: 0.7;
            shape-rendering: crispEdges;
        }
        
        .grid path {
            stroke-width: 0;
        }
        
        div.tooltip {
            position: absolute;
            text-align: center;
            width: 160px;
            height: 80px;
            padding: 2px;
            font: 12px sans-serif;
            background: rgb(233, 233, 233);
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
    </style>
</head>

<body>

    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>

    <script>
        var margin = {
                top: 50,
                right: 20,
                bottom: 30,
                left: 50
            },
            width = 360 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;


        var x = d3.scale.linear().range([0, width]);
        var y = d3.scale.linear().range([height, 0]);

        var xAxis = d3.svg.axis().scale(x)
            .orient("bottom").ticks(5);

        var yAxis = d3.svg.axis().scale(y)
            .orient("left").ticks(5);

        var valueline = d3.svg.line()
            .interpolate("cardinal")
            .x(function(d) {
                return x(d.intenseness);
            })
            .y(function(d) {
                return y(d.score_mean);
            });

        var div = d3.select("body").append("div")
            .attr('class', 'tooltip')
            .style('opacity', 0);

        var svg = d3.select("body")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


        function make_x_axis() {
            return d3.svg.axis()
                .scale(x)
                .orient("bottom")
                .ticks(5)
        }

        function make_y_axis() {
            return d3.svg.axis()
                .scale(y)
                .orient("left")
                .ticks(5)
        }


        d3.csv("df_m1.csv", function(error, data) {
            data.forEach(function(d) {
                d.year = +d.year;
                d.score_mean = +d.score_mean
                d.intenseness = +d.intenseness
            });


            x.domain(d3.extent(data, function(d) {
                return d.intenseness;
            }));
            y.domain([85, 91]);


            svg.append("g")
                .attr('class', "grid")
                .attr('transform', "translate(0," + height + ")")
                .call(make_x_axis()
                    .tickSize(-height, 0, 0)
                    .tickFormat("")
                )

            svg.append("g")
                .attr('class', "grid")
                .call(make_y_axis()
                    .tickSize(-width, 0, 0)
                    .tickFormat("")
                )


            svg.append("path")
                .attr('class', "line")
                .attr('d', valueline(data));

            svg.append("g")
                .attr('class', "x axis")
                .attr('transform', 'translate(0,' + height + ')')
                .call(xAxis);


            svg.append("text")
                .attr('x', width / 2)
                .attr('y', height + margin.bottom)
                .style('text-anchor', 'middle')
                .text("接戦の度合(標準偏差^-1)");

            svg.append("g")
                .attr('class', "y axis")
                .call(yAxis);

            svg.append("text")
                .attr('transform', "rotate(-90)")
                .attr('y', 0 - margin.left)
                .attr('x', 0 - (height / 2))
                .attr('dy', "1em")
                .style('text-anchor', 'middle')
                .text('得点の平均');

            svg.append("text")
                .attr('x', (width / 2))
                .attr('y', 0 - (margin.top / 2))
                .attr('text-anchor', "middle")
                .style('font-size', '14px')
                .text("■M1各大会の平均点と接戦度合の軌跡");

            svg.append("text")
                .attr('x', 240)
                .attr('y', 35)
                .style('font-size', '14px')
                .text("2017年");

            svg.append("text")
                .attr('x', 50)
                .attr('y', 385)
                .style('font-size', '12px')
                .text("2003年");


            svg.selectAll("dot")
                .data(data)
                .enter().append('circle')
                .attr('cx', function(d) {
                    return x(d.intenseness);
                })
                .attr('cy', function(d) {
                    return y(d.score_mean);
                })
                .attr('r', function(d) {
                    if (d.year == 2017) {
                        return 4.5
                    } else {
                        return 3.5
                    };
                })
                .style('fill', function(d) {
                    if (d.year == 2017) {
                        return "steelblue"
                    } else {
                        return "lightsteelblue"
                    };
                })
                .on("mouseover", function(d) {
                    div.transition()
                        .duration(200)
                        .style('opacity', .9);
                    div.html(d.year + "年大会<br/>優勝: " + d.winner + "<br/>接戦の度合: " + d.intenseness.toFixed(2) + "<br/>得点の平均: " + d.score_mean.toFixed(2))
                        .style('left', (d3.event.pageX + 20) + "px")
                        .style('top', (d3.event.pageY - 40) + "px");
                })
                .on("mouseout", function(d) {
                    div.transition()
                        .duration(500)
                        .style('opacity', 0);
                });


        });
    </script>


</body>

</html>